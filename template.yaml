"$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#"
contentVersion: 1.0.0.0
parameters:
  vulnerabilityAssessments_Default_storageContainerPath:
    type: SecureString
  servers_linktechdbserver_name:
    defaultValue: linktechdbserver
    type: String
  staticSites_LinkTech_WebApp_name:
    defaultValue: LinkTech-WebApp
    type: String
  virtualNetworks_azce_prd_spk_LinkTech_vnet_name:
    defaultValue: azce-prd-spk-LinkTech-vnet
    type: String
  networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name:
    defaultValue: azce-prd-spk-LinkTech-nsg
    type: String
  virtualNetworks_azce_prd_hub_LinkTech_vnet_externalid:
    defaultValue: "/subscriptions/c23271e6-01ae-4dfa-85d3-783bf6dfa210/resourceGroups/azce-prd-hub-LinkTech-RG/providers/Microsoft.Network/virtualNetworks/azce-prd-hub-LinkTech-vnet"
    type: String
variables: {}
resources:
  - type: Microsoft.Network/networkSecurityGroups
    apiVersion: '2022-11-01'
    name: "[parameters('networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name')]"
    location: canadaeast
    properties:
      securityRules:
        - name: AllowCustomVNetInBound
          id: "[resourceId('Microsoft.Network/networkSecurityGroups/securityRules', parameters('networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name'), 'AllowCustomVNetInBound')]"
          type: Microsoft.Network/networkSecurityGroups/securityRules
          properties:
            protocol: "*"
            sourcePortRange: "*"
            destinationPortRange: "*"
            sourceAddressPrefix: VirtualNetwork
            destinationAddressPrefix: VirtualNetwork
            access: Allow
            priority: 100
            direction: Inbound
            sourcePortRanges: []
            destinationPortRanges: []
            sourceAddressPrefixes: []
            destinationAddressPrefixes: []
        - name: AllowCustomAzureLoadBalancerInBound
          id: "[resourceId('Microsoft.Network/networkSecurityGroups/securityRules', parameters('networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name'), 'AllowCustomAzureLoadBalancerInBound')]"
          type: Microsoft.Network/networkSecurityGroups/securityRules
          properties:
            protocol: "*"
            sourcePortRange: "*"
            destinationPortRange: "*"
            sourceAddressPrefix: AzureLoadBalancer
            destinationAddressPrefix: "*"
            access: Allow
            priority: 110
            direction: Inbound
            sourcePortRanges: []
            destinationPortRanges: []
            sourceAddressPrefixes: []
            destinationAddressPrefixes: []
        - name: AllowAnyHTTPInbound
          id: "[resourceId('Microsoft.Network/networkSecurityGroups/securityRules', parameters('networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name'), 'AllowAnyHTTPInbound')]"
          type: Microsoft.Network/networkSecurityGroups/securityRules
          properties:
            protocol: TCP
            sourcePortRange: "*"
            destinationPortRange: '80'
            sourceAddressPrefix: "*"
            destinationAddressPrefix: "*"
            access: Allow
            priority: 120
            direction: Inbound
            sourcePortRanges: []
            destinationPortRanges: []
            sourceAddressPrefixes: []
            destinationAddressPrefixes: []
        - name: AllowAnyHTTPSInbound
          id: "[resourceId('Microsoft.Network/networkSecurityGroups/securityRules', parameters('networkSecurityGroups_azce_prd_spk_LinkTech_nsg_name'), 'AllowAnyHTTPSInbound')]"
          type: Microsoft.Network/networkSecurityGroups/securityRules
          properties:
            protocol: TCP
            sourcePortRange: "*"
            destinationPortRange: '443'
            sourceAddressPrefix: "*"
            destinationAddressPrefix: "*"
            access: Allow
            priority: 130
            direction: Inbound
            sourcePortRanges: []
            destinationPortRanges: []
            sourceAddressPrefixes: []
            destinationAddressPrefixes: []
  - type: Microsoft.Network/virtualNetworks
    apiVersion: '2022-11-01'
    name: "[parameters('virtualNetworks_azce_prd_spk_LinkTech_vnet_name')]"
    location: canadaeast
    tags:
      Production Spoke VNet: ''
    properties:
      addressSpace:
        addressPrefixes:
          - 10.1.0.0/16
      subnets:
        - name: default
          id: "[resourceId('Microsoft.Network/virtualNetworks/subnets', parameters('virtualNetworks_azce_prd_spk_LinkTech_vnet_name'), 'default')]"
          properties:
            addressPrefix: 10.1.0.0/24
            delegations: []
           
